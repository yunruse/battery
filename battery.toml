[functions.is_discharging]
description = "Check if battery is discharging (i.e. in use)."
type = "boolean"
[functions.is_charging]
description = "Check if battery is charging."
type = "boolean"
[functions.percent]
description = "Return percentage charge of battery in [0, 100]."
[functions.minutes_remaining]
description = "Minutes of battery life left (may be empty if not known yet)."
[functions.minutes_until_charged]
description = "Minutes until the battery is charged (may be 0 if full, or empty if not on charge or not known)."
[functions.capacity]
description = "Battery's current capacity in mAh (mWh on Windows)."
[functions.design_capacity]
description = "Battery's original capacity in mAh (mWh on Windows)."


# Some of the extra pipes are to produce a standardised format and may not be necessary depending on your purpose.
# The unixy `grep -qv foo; echo $?` idiom is useful for "does this contain foo"

[commands.macos]
# pmset -g batt outputs a fairly standard format
is_discharging = "pmset -g batt | head -n1 | grep -qv \"'Battery Power'\"; echo $?"
is_charging = "pmset -g batt | grep InternalBattery | grep -qv '; charging'; echo $?"
percent = "pmset -g batt | grep InternalBattery | grep -Eo '\\d+%'| grep -Eo '\\d+'"
minutes_remaining = "pmset -g batt | grep discharging | grep -Eo '\\d+:\\d+' | awk '{S=($1*60)+$2}END{print S}' FS=:"
minutes_until_charged = "pmset -g batt | grep ' charg' | grep -Eo '\\d+:\\d+' | awk '{S=($1*60)+$2}END{print S}' FS=:"
# TODO: can these be faster? it's a tad slow
capacity = "ioreg -l -w0 | grep '\"MaxCapacity\" = ' | grep -Eo '\\d+'"
design_capacity = "ioreg -l -w0 | grep '\"DesignCapacity\" = ' | grep -Eo '\\d+'"

[commands.windows] # using powershell
# cf https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/win32-battery
is_discharging = "(Get-Wmi-Object -Class 'BatteryStatus' -Namespace 'root\\wmi').Discharging | %{[int32]$_}"
is_charging = "(Get-Wmi-Object -Class 'BatteryStatus' -Namespace 'root\\wmi').Charging | %{[int32]$_}"
percent = "((WMIC PATH Win32_Battery Get EstimatedChargeRemaining) -split '\n')[2]"
# 0x4444444 = 71582788 means N/A (not a magical 136yr battery. imagine)
# for some reason PS dislikes a ternary if operator here, so we use the classic index-list-by-bool trick
minutes_remaining = "[int32]((WMIC PATH Win32_Battery Get EstimatedRunTime) -split '\n')[2] | %{@('', $_)[$_ -ne 71582788]}"
minutes_until_charged = "[int32]((WMIC PATH Win32_Battery Get BatteryRechargeTime) -split '\n')[2] | %{@('', $_)[$_ -ne 71582788]}"
capacity = "((WMIC PATH Win32_Battery Get FullChargeCapacity) -split '\n')[2]"
design_capacity = "((WMIC PATH Win32_Battery Get DesignCapacity) -split '\n')[2]"
